<script>


  function crearTablaContactos() {
    let tabla = document.getElementById("tablaContactos");
    if (tabla) tabla.remove();

    google.script.run
      .withSuccessHandler(crearTablaContactosCorrectamente)
      .withFailureHandler(crearTablaContactosError)
      .obtenerContactos();
  }

  function crearTablaContactosCorrectamente(obj) {
    tabla = document.createElement("table");
    tabla.id = "tablaContactos";

    let tablaHeader = document.createElement("thead");
    let tablaBody = document.createElement("tbody");

    //header de la tabla
    let primeraFila = document.createElement("tr");
    for (let i = 0; i < obj[0].length; i++) {
      let celda = document.createElement("td");
      celda.textContent = obj[0][i];
      primeraFila.appendChild(celda);
    }
    tablaHeader.appendChild(primeraFila);
    tabla.appendChild(tablaHeader);

    //body de la tabla
    for (let i = 1; i < obj.length; i++) {
      let fila = document.createElement("tr");
      for (let j = 0; j < obj[i].length; j++) {
        let celda = document.createElement("td");
        celda.textContent = obj[i][j];
        fila.appendChild(celda);
      }
      tablaBody.appendChild(fila);
    }
    //agragamos clases a la cabecera
    tablaHeader.classList.add('table-dark')
    //agregamos el cuerpo de la tabla
    tabla.appendChild(tablaBody)
    tabla.classList.add('table', 'table-striped', 'border', 'border-1', 'border-dark')
    //agregamos tabla a la página
    document.getElementById('divContactos').appendChild(tabla)


    //mostrat notificación de OK
    crearNotificacionOK('contactos obtenidos correctamente', 'todo en orden')
  }

  function crearTablaContactosError() {
    //MOstrar notificación de error
    crearNotificacionError('No se han podido  leer los contactos', 'ERROR')
  }

function crearNotificacion(mensaje, titulo) {
  document.getElementById('mensajeNotificacion').textContent = mensaje
  document.getElementById('tituloNotificacion').textContent = titulo
  let elementoNotificacion = document.getElementById('notificacion')
  bootstrap.Toast.getOrCreateInstance(elementoNotificacion).show()
}

function crearNotificacionOK(mensaje, titulo) {

  crearNotificacion(mensaje, titulo)
  crearIconoNotificacionOK()
  crearColorNotificacion('--color-verde-oscuro')
}

function crearNotificacionError(mensaje, titulo) {
  crearNotificacion(mensaje, titulo)
  crearIconoNotificacionError()
  crearColorNotificacion('--color-rojo-oscuro')
}

function crearNotificacionAdvertencia(mensaje, titulo) {
  crearNotificacion(mensaje, titulo)
  crearIconoNotificacionAdvertencia()
  crearColorNotificacion('--color-amarillo-oscuro')
}
 

function crearIconoNotificacionOK() {
  document.getElementById('iconoNotificacion').className=''
  document.getElementById('iconoNotificacion').classList.add('bi', 'bi-check2-square')
}

function crearIconoNotificacionError() {
  document.getElementById('iconoNotificacion').className=''
  document.getElementById('iconoNotificacion').classList.add('bi', 'bi-bug')
}

function crearIconoNotificacionAdvertencia() {
  document.getElementById('iconoNotificacion').className=''
  document.getElementById('iconoNotificacion').classList.add('bi', 'bi-exclamation-square')
}

function crearColorNotificacion(color) {
  let elementoNotificacion = document.getElementById('notificacion')
  elementoNotificacion.style.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue(color)
}



//----------------------------------------------------------------------------------

  //   function crearTablaContactos() {
  //   let tabla = document.getElementById("tablaContactos");
  //   if (tabla) tabla.remove();

  //   google.script.run
  //     .withSuccessHandler(function (datos) {
  //       const tabla = construirTabla(datos);
  //       document.getElementById("divContactos").appendChild(tabla);
  //     })
  //     .withFailureHandler(function (error) {
  //       console.log("Error al obtener los contactos:", error);
  //     })
  //     .obtenerContactos();
  // }

  // function construirTabla(datos) {
  //   const tabla = document.createElement("table");
  //   tabla.id = "tablaContactos";

  //   // Crea el encabezado de la tabla
  //   const encabezado = document.createElement("thead");
  //   const primeraFila = document.createElement("tr");
  //   datos[0].forEach(function (valor) {
  //     const celda = document.createElement("th");
  //     celda.textContent = valor;
  //     primeraFila.appendChild(celda);
  //   });
  //   encabezado.appendChild(primeraFila);
  //   tabla.appendChild(encabezado);

  //   // Crea el cuerpo de la tabla
  //   const cuerpo = document.createElement("tbody");
  //   datos.slice(1).forEach(function (fila) {
  //     const nuevaFila = document.createElement("tr");
  //     fila.forEach(function (valor) {
  //       const celda = document.createElement("td");
  //       celda.textContent = valor;
  //       nuevaFila.appendChild(celda);
  //     });
  //     cuerpo.appendChild(nuevaFila);
  //   });
  //   tabla.appendChild(cuerpo);

  //   // Agrega clases a la tabla y al encabezado
  //   tabla.classList.add("table", "table-striped", "border", "border-3", "table-dark");
  //   encabezado.classList.add("table-success");

  //   return tabla;
  // }
</script>
